{
  "page_content": "Tương tựvới image describer tool, ta implement một tool có khảnăng detect object và đếm số lượng object có trong hình. Tool này sửdụng mô hình YOLOv11 đểnhận dạng và đếm object. Chúng ta load mô hình YOLO11x như sau:  \n1 `yolo_model = YOLO( \"yolo11x.pt\" )`  \nSau đó, chúng ta có thểtạo tool từmột hàm với decorator `@tool` được cung cấp sẵn từthư viện LangChain:  \n1 `class ObjectDetectingAndCountingInput (BaseModel):` 2 `text: str = Field(description= \"Path or URL to the image in the format PNG or JPG/JPEG\" )` 3 4 `@tool(` 5 `\" detect_and_count_objects \" ,` 6 `description= \"Detect and count objects within the image. The return will be a dictionary , containing the counting dictionary (counting how many instance of each object class) and a list of dictionaries , containing the object names , confidence scores , and location in the image (in (x1 , x2 , y1 , y2) format).\" ,` 7 `args_schema= ObjectDetectingAndCountingInput` 8 `)` 9 `def detect_and_count_object_tool (` 10 `text: Annotated[ str , \"Path or URL to the image\" ]` 11 `):` 12 `\"\"\" Detect objects within the image using YOLOv11 model \"\"\"` 13 14 `try :` 15 `parsed: ImageInput = extractor_chain .invoke ({ \"input\" : text })` 16 `except Exception as e:` 17 `return f \"Failed to extract image URL: {str(e)}\"` 18 19 `image_path_or_url = parsed. image_path_or_url` 20 `if not image_path_or_url :` 21 `return \"No image URL found in the input.\"` 22 23 `results = yolo_model(image_path_or_url , verbose=False)` 24 25 `detections = []` 26 `counting = {}` 27 28 `# Process each result` 29 `for result in results:` 30 `boxes = result.boxes` 31 `class_names = result.names` 32 33 `for box in boxes:` 34 `class_id = int (box.cls [0])` 35 `class_name = class_names[class_id]` 36 `confidence = float (box.conf [0])` 37 `x1 , y1 , x2 , y2 = map ( int , box.xyxy [0])` 38 39 `detections.append ({` 40 `\"class\" : class_name ,`  \n--- end of page.page_number=14 ---  \n**AI VIETNAM**  \n**aivietnam.edu.vn**  \n41 `\"confidence\" : confidence ,` 42 `\"bbox\" : (x1 , y1 , x2 , y2)` 43 `})` 44 45 `counting[class_name] = counting.get(class_name , 0) + 1` 46 47 `return str ({ \"counting\" : counting , \"detections\" : detections })`  \nTương tựresearch agent ởphần trước, ta có thểtạo visual agent dựa trên pattern reasoning-acting của ReAct với hàm `create_react_agent` và hai tool  \n`image_describer_tool` , `detect_and_count_object_tool` như sau:  \n1 `vision_agent = create_react_agent (` 2 `model= \"gpt -4o-mini\" ,` 3 `tools =[ image_describer_tool , detect_and_count_object_tool ],` 4 `prompt =(` 5 `\"You are a vision agent .\\n\\n\"` 6 `\"INSTRUCTIONS :\\n\"` 7 `\"- Assist ONLY with visual tasks (e.g., describing images , detecting and counting objects)\\n\"` 8 `\"- Use only the tools provided to analyze visual inputs\\n\"` 9 `\"- After completing your task , respond to the supervisor directly\\n\"` 10 `\"- Respond ONLY with the results of your work , do NOT include ANY other text.\"` 11 `),` 12 `name= \"vision_agent\"` 13 `)`  \nTa có thểsửdụng visual agent như sau:  \n1 `for chunk in vision_agent.stream(`  \n2  \n3 `):`  \n4  \n```\n{\"messages\":[{\"role\":\"user\",\"content\":\"howmanydoginimage:https ://s3.\namazonaws.com/cdn -origin -etr.akc.org/wp -content/uploads /2018/04/24144817/\nAmerican -Staffordshire -Terrier -lying -outdoors -next -to -a-kitten -that -is -playing\n-with -the -dogs -nose.jpg\"}]}\npretty_print_messages (chunk)\n```  \nvà kết quảnhận được là:  \n1 `Update from node agent:` 2 3 4 `================================== Ai Message ==================================` 5 `Name: vision_agent` 6 `Tool Calls:` 7 `detect_and_count_objects ( call_ZMQi8IvMsQU8nL3vZZP2aIPh )` 8 `Call ID: call_ZMQi8IvMsQU8nL3vZZP2aIPh` 9 `Args: text: https ://s3.amazonaws.com/cdn -origin -etr.akc.org/wp -content/uploads /2018/04/24144817/ American -Staffordshire -Terrier -lying -outdoors -next -to -akitten -that -is -playing -with -the -dogs -nose.jpg`  \n10  \n11 12\n\n10  \n11 12  \n13 `Found https ://s3.amazonaws.com/cdn -origin -etr.akc.org/wp -content/uploads /2018/04/24144817/ American -Staffordshire -Terrier -lying -outdoors -next -to -akitten -that -is -playing -with -the -dogs -nose.jpg locally at American - Staffordshire -Terrier -lying -outdoors -next -to -a-kitten -that -is -playing -with -the -dogs -nose.jpg` 14 `Update from node tools:`  \n--- end of page.page_number=15 ---  \n**AI VIETNAM**  \n**aivietnam.edu.vn**  \n**==> picture [476 x 176] intentionally omitted <==**  \n**----- Start of picture text -----**<br>\n16<br>17 ================================= Tool Message =================================<br>18 Name: detect_and_count_objects<br>19<br>20 {\" counting \": {\"dog\": 2}, \"detections \": [{\" class \": \"dog\", \"confidence \":<br>0.9411600232124329 , \"bbox \": (287 , 73, 618, 445)}, {\" class \": \"dog\", \"confidence<br>\": 0.8354390263557434 , \"bbox \": (159 , 120, 369, 418) }]}<br>21<br>22<br>23 Update from node agent:<br>24<br>25<br>26 ================================== Ai Message ==================================<br>27 Name: vision_agent<br>28<br>29 2<br>**----- End of picture text -----**<br>\n\n## **7. Xây dựng supervisor agent**  \nHai agent chúng ta vừa xây dựng hoạt động độc lập, riêng lẻvới nhau. Đểtích hợp cảhai vào cùng một hệthống và hệthống tựđộng chuyển query của người dùng đến agent tương ứng có khảnăng xửlí query đó, ta tạo một supervisor agent như sau:  \n**==> picture [246 x 294] intentionally omitted <==**  \nHình 7: Supervisor Agent.  \n1 `supervisor = create_supervisor (`  \n2 `model= init_chat_model ( \"gpt -4o-mini\" ),` 3 `agents =[ research_agent , vision_agent ],` 4 `prompt =(`  \n4 5 6  \n```\n\"Youareasupervisormanagingtwoagents :\\n\"\n\"-research_agent:UsethisagentONLYforresearch -relatedtasks(e.g.,\nsearchinginformation ,findingpapers ,summarizingdocuments).\\n\"\n```  \n--- end of page.page_number=16 ---  \n**AI VIETNAM**  \n**aivietnam.edu.vn**  \n7 `\"- vision_agent: Use this agent ONLY for visual tasks (e.g., describing images , detecting and counting objects).\\n\\n\"` 8 `\"RULES :\\n\"` 9 `\"- Assign tasks to only one agent at a time .\\n\"` 10 `\"- Do NOT call multiple agents in parallel .\\n\"` 11 `\"- Do NOT perform any work yourself - always delegate .\\n\"` 12 `\"- Be concise when handing off tasks to agents , only provide what is necessary for them to complete the job.\"` 13 `),` 14 `add_handoff_back_messages =True ,` 15 `output_mode= \"full_history\" , # or \" final_output \" if you want clean result` 16 `). compile ()`  \nTrong đó, prompt định nghĩa system prompt của supervisor agent của chúng ta. Ta đưa vào hai agents là `[research_agent, vision_agent]` và sửdụng mô hình gpt-4o-mini làm bộnão của supervisor agent.  \nKiến trúc của supervisor agent có thểđược miêu tảtrong ảnh 8.  \n**==> picture [344 x 185] intentionally omitted <==**  \nHình 8: Supervisor Agent State Diagram.",
  "metadata": {
    "H2": "**6. Xây dựng Visual Agent** -> **6. Xây dựng Visual Agent** -> **7. Xây dựng supervisor agent** -> **8. Inference**",
    "source": "Description-Visual-Agentic-AI.pdf",
    "parent_id": "Description-Visual-Agentic-AI_parent_9"
  }
}