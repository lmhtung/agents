{
  "page_content": "## **6. Xây dựng Visual Agent**  \n**==> picture [466 x 77] intentionally omitted <==**  \nHình 6: Visual Agent.  \nChúng ta tiếp tục xây dựng một visual agent có khảnăng xửlí các thông tin liên quan đến hình ảnh, ví dụnhư nhận diện vật thểtrong hình, đếm vật thể, v.v...  \nĐối với OpenAI API, ta phải mã hoá hình ảnh dưới dạng base64 đểgửi trong message đến server. Do đó, ta thiết kếhàm `encode_image` dùng đểđọc hình ảnh từfile path hoặc từURL và trảvề dưới dạng base64 như sau:  \n1 `def encode_image( image_path_or_url : str , get_mime_type : bool = False):` 2 `if image_path_or_url .startswith( \"http\" ):` 3 `try :` 4 `response = requests.get(image_path_or_url , stream=True)` 5 `response. raise_for_status ()` 6 `image = response.content` 7 `mime_type = response.headers.get( \"content -type\" , None)` 8 `base64_encoded = base64.b64encode(image).decode( \"utf -8\" )` 9 `if get_mime_type :` 10 `return base64_encoded , mime_type` 11 `else :` 12 `return base64_encoded` 13 `except requests.exceptions. RequestException as e:` 14 `print (f \"Request error: {e}\" )` 15 `if get_mime_type :` 16 `return None , None` 17 `else :` 18 `return None` 19 `else :` 20 `if not os.path.exists( image_path_or_url ):` 21 `return None , None` 22 `mime_type = magic.Magic(mime=True).from_file( image_path_or_url )`  \n--- end of page.page_number=11 ---  \n**AI VIETNAM**  \n**aivietnam.edu.vn**  \n23 `if mime_type.startswith( \"image/\" ):` 24 `with open (image_path_or_url , \"rb\" ) as image_file:` 25 `if get_mime_type :` 26 `return base64.b64encode(image_file.read ()).decode( \"utf -8\" ), mime_type` 27 `else :` 28 `return base64.b64encode(image_file.read ()).decode( \"utf -8\" )` 29 `else :` 30 `if get_mime_type :` 31 `return None , None` 32 `else :` 33 `return None`  \nTiếp theo, ta thiết kếmột tool URL extractor đểtrích xuất image URL từmessage của người dùng. Ta ví dụrằng nếu người dùng đưa một message như  \n`What is the object inside this image: https://www.abc.com/image.png` thì tool có khả năng trích xuất image URL trong message là https://www.abc.com/image.png đểcó thểxửlí ảnh dưới dạng base64 trước khi gửi đến server OpenAI. URL extractor tool được thiết kếnhư sau:  \n1 `class ImageInput(BaseModel):` 2 `image_path_or_url : str = Field(description= \"Image path or URL\" )`  \n3  \n4 `parser = PydanticOutputParser ( pydantic_object =ImageInput)` 5 6 `prompt = PromptTemplate.from_template(` 7 `\"Extract the image path or URL from the following input :\\n\\n{input }\\n\\n{ format_instructions }\"` 8 `).partial( format_instructions =parser. get_format_instructions ())` 9 10 `extractor_chain = prompt | llm | parser` 11 `output = extractor_chain .invoke ({ \"input\" : \"Please describe the following image in detailed: \" https :// example.com/image.png \"\" })` 12 `output`  \n13 14 `# Output: ImageInput( image_path_or_url =\" https :// example.com/image.png\")`  \nBên cạnh việc mô hình LLM của chúng ta có thểxửlí hình ảnh, ta cũng có thểtrang bịthêm các công cụhỗtrợđểmô hình có thêm nhiều thông tin từhình ảnh hơn, từđó đưa ra câu trảlời chính xác.  \nĐầu tiên, ta xây dựng tool miêu tảhình ảnh `image_describer_tool` như sau:",
  "metadata": {
    "H2": "**6. Xây dựng Visual Agent**",
    "source": "Description-Visual-Agentic-AI.pdf",
    "parent_id": "Description-Visual-Agentic-AI_parent_7"
  }
}