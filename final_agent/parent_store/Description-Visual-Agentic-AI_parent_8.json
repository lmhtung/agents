{
  "page_content": "Đầu tiên, ta xây dựng tool miêu tảhình ảnh `image_describer_tool` như sau:  \n1 `class ImageDescription (BaseModel):` 2 `image_description : str = Field(description= \"Detailed description of the image \" )` 3 4 `def image_describer_prompt_func (inputs: dict ):` 5 `image_path_or_url = inputs[ \" image_path_or_url \" ]` 6 `image_b64 , image_mime_type = encode_image(image_path_or_url , get_mime_type = True)` 7 8 `image_describer_chat_template = ChatPromptTemplate . from_messages ([` 9 `SystemMessage(` 10 `content= \"\"\" You are an expert image describer. When presented with an image , provide a detailed , accurate , and objective description of its visible content. Focus on aspects such as:` 11 `- Objects present , their positions , and relationships` 12 `- Colors , lighting , composition , and textures` 13 `- Actions or dynamics , if any (e.g., people walking , water flowing)` 14 `- Contextual or inferred information (e.g., likely setting , era , or activity)`  \n--- end of page.page_number=12 ---  \n**AI VIETNAM**  \n**aivietnam.edu.vn**  \n15 16 `Avoid adding information that is not visible or cannot be reasonably inferred from the image. Do not speculate or inject personal opinion unless explicitly requested. If text appears in the image , transcribe it accurately. \"\"\" ),` 17 `HumanMessage(content =[` 18 `{ \"type\" : \"text\" , \"text\" : \"Describe the following image for me:\" },` 19 `{` 20 `\"type\" : \"image_url\" ,` 21 `\"image_url\" : { \"url\" : f \"data :{ image_mime_type };base64 ,{ image_b64}\" , \"detail\" : \"low\" }` 22 `}` 23 `])` 24 `])` 25 `return image_describer_chat_template .invoke ({})` 26 27 `class ImageDescriberInput (BaseModel):` 28 `text: str = Field(description= \"Path or URL to the image in the format PNG or JPG/JPEG\" )` 29 30 `class ImageDescriberTool (BaseTool):` 31 `name: str = \"image_describer \"` 32 `description: str = \"This tool can describe the image in a detailed way\"` 33 `args_schema: Optional[ArgsSchema] = ImageDescriberInput` 34 `return_direct: bool = True` 35 36 `def _run(self , text: str , run_manager: Optional[ CallbackManagerForToolRun ] = None) -> str :` 37 `\"\"\" Use the tool.\"\"\"` 38 `try :` 39 `parsed: ImageInput = extractor_chain .invoke ({ \"input\" : text })` 40 `except Exception as e:` 41 `return f \"Failed to extract image URL: {str(e)}\"` 42 43 `image_path_or_url = parsed. image_path_or_url` 44 `if not image_path_or_url :` 45 `return \"No image URL found in the input.\"` 46 `output = image_describer_agent .invoke ({ \" image_path_or_url \" : image_path_or_url })` 47 `return output. image_description` 48 49 `async def _arun(self , image_path_or_url : str , run_manager: Optional[ AsyncCallbackManagerForToolRun ] = None) -> str :` 50 `\"\"\" Use the tool asynchronously .\"\"\"` 51 `return self._run(image_path_or_url , run_manager=run_manager)`  \nTrong đó, `ImageDescription` là output format của image describing agent mà mình quy định. Ở đây, ta định nghĩa output format chứa image_description dưới dạng string và miêu tảfield này một cách cụthểđểmô hình có thểhiểu công dụng của field này.  \nTiếp theo, ta thiết kếprompt cho image describer gồm system message và human message. System message quy định ảnh sẽđược miêu tảcụthể, chi tiết, rõ ràng, còn human message chứa ảnh từ người dùng.  \nCuối cùng, chúng ta viết class ImageDescriberTool và implement hai method `_run` và `_arun` để định nghĩa cách tool hoạt động.  \nTa dùng hàm `.invoke()` đểchạy thửtool như sau:  \n1 `image_describer_tool = ImageDescriberTool ()`  \n--- end of page.page_number=13 ---  \n**AI VIETNAM**  \n**aivietnam.edu.vn**  \n2 `image_describer_tool .invoke( \"https :// github. githubassets .com/assets/GitHub -Mark - ea2971cee799.png\" )` 3 `# Output: The image features a black circle with a white silhouette of a cat -like figure in the center. The figure has a rounded head with two pointed ears , a small rounded body , and a curved tail extending to the left. The design is simple and stylized , with no additional details or features.`",
  "metadata": {
    "H2": "**6. Xây dựng Visual Agent**",
    "source": "Description-Visual-Agentic-AI.pdf",
    "parent_id": "Description-Visual-Agentic-AI_parent_8"
  }
}